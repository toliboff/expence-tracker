<div class='container'>
  <%= form_with model: @entity,  url: user_group_entities_path(params[:user_id], params[:group_id]), method: 'post', class: "flex-column form", id:'transaction_form' do |form| %>
    <header class="header flex-row">
      <div>
        <%= link_to user_group_path(params[:user_id],  params[:group_id]) do %>
            <%= image_tag('left-arrow.png', size: "20x20") %>
          <% end %>
      
      </div>
      <div class="title">
        NEW TRANSACTION
      </div>
      <div>
        <button id="submit_button" class='submit' >Save</button>
      </div>

    </header>
    <%= render partial: 'shared/messages' %>
    <%= form.text_field :name, id:'name', autofocus: true, placeholder:'Transaction name', required: true %>
    <%= form.number_field :amount, id:'amount', step: 0.01, min:0.01, placeholder:'Amount', required: true %>
    <%= form.hidden_field :checked, id:'checked-items' %>
    
    <%= field_set_tag 'Categories', class:'checkboxes' do %>
      <%= form.collection_check_boxes :group_ids, @groups, :id, :name, { hide_label: true } %>
    <% end %>
    <% end %>
</div>

<script>
  let checked_items = document.querySelector('#checked-items')
  let name = document.querySelector('#name')
  let amount = document.querySelector('#amount')
  let submit_button = document.querySelector('#submit_button')

  setInterval(() => {
    let checkboxes = document.querySelectorAll('input[type="checkbox"]:checked')
    checked_items.value = checkboxes.length
  }, 100);



const form = document.getElementById('transaction_form');
form.addEventListener('submit', (event) => { 
  event.preventDefault()
  });

function validateSubmit() {
  if (checked_items.value > 0 && name.value.trim().length>0 && amount.value > 0) {
    form.submit()
  }
}

submit_button.addEventListener('click', validateSubmit)
</script>